<!DOCTYPE html>
<html lang="en">

<head>

    <title>Home Page</title>
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css?family=Caesar+Dressing" rel="stylesheet">
    <script type="text/javascript">

            //add game board image to background
    function draw() {
        var ctx = document.getElementById('myCanvas').getContext('2d');
        var img = document.getElementById("gameBoard");
        ctx.drawImage(img, 10, 10, 800, 600);

        //track coordinates of mouse movement
        // var ctx = document.getElementById('myCanvas').getContext('2d');
        //     ctx.canvas.addEventListener('mousemove', function(event){
        //     var mouseX = event.clientX - ctx.canvas.offsetLeft;
        //     var mouseY = event.clientY - ctx.canvas.offsetTop;
        //     var status = document.getElementById('status');
        //     status.innerHTML = mouseX+" | "+mouseY; 
        // });

        //dynamically create squares when user clicks mouse
        // var ctx = document.getElementById('myCanvas').getContext('2d');
        //     ctx.canvas.addEventListener('click', function(event){
        //     var mouseX = event.clientX - ctx.canvas.offsetLeft;
        //     var mouseY = event.clientY - ctx.canvas.offsetTop;
        //     var status = document.getElementById('status');
        //     // alert(mouseX+" | "+mouseY);
        //     ctx.fillStyle = "red";
        //     ctx.fillRect(mouseX-15, mouseY-15, 30, 30);
        // });
    }
            // window.onload = draw;

            drawplayer1 = function(position, avatar){

                player1PosArray = [
                [40,35],[95,45],[120,65],[135,95],[138,130],[138,170],[130,210],[125,250],[120,290],[118,330],[118,370],
                [122,410],[145,450],[185,465],[218,465],[242,445],[250,410],[250,380],[250,350],[248,320],[235,280],
                [230,240],[230,210],[230,170],[235,130],[255,90],[290,80],[325,80],[350,105],[360,130],[370,160]
            ];

                var p1Pos = position;
                var ctx = document.getElementById('myCanvas').getContext('2d');
                var player1 = document.getElementById(avatar);
                // ctx.drawImage(player1, 40, 35, 60, 60);
                ctx.drawImage(player1, player1PosArray[p1Pos][0], player1PosArray[p1Pos][1], 60, 60);
            };

            drawplayer2 = function(position, avatar) {

                player2PosArray = [
                [38,512],[112,515],[150,512],[190,512],[230,512],[275,515],[320,525],[365,525],[405,530],[450,532],[490,530],
                [535,515],[565,485],[580,450],[568,415],[530,400],[495,390],[460,390],[422,395],[390,410],[355,410],
                [325,415],[292,415],[260,415],[220,405],[190,385],[175,350],[185,310],[205,288],[240,280],[270,280]
            ];

                var p2Pos = position;
                var ctx = document.getElementById('myCanvas').getContext('2d');
                var player2 = document.getElementById(avatar);
                // ctx.drawImage(player2, 38, 512, 60, 60);
                ctx.drawImage(player2, player2PosArray[p2Pos][0], player2PosArray[p2Pos][1], 60, 60);
            };

            drawplayer3 = function(position, avatar) {

                player3PosArray = [
                [710,40],[640,50],[590,55],[545,55],[505,55],[450,45],[410,45],[365,35],[315,35],[270,35],[235,40],
                [200,65],[190,85],[180,120],[200,150],[230,165],[265,175],[300,175],[330,170],[370,160],[405,155],
                [438,152],[470,152],[510,152],[550,165],[575,190],[585,225],[578,258],[555,275],[520,285],[490,290]
            ];

                var p3Pos = position;
                var ctx = document.getElementById('myCanvas').getContext('2d');
                var player3 = document.getElementById(avatar);
                // ctx.drawImage(player3, 490, 290, 60, 60);
                ctx.drawImage(player3, player3PosArray[p3Pos][0], player3PosArray[p3Pos][1], 60, 60);
            };

            drawplayer4 = function(position, avatar) {

                player4PosArray = [
                [710,510],[660,510],[635,475],[625,435],[625,395],[630,360],[635,320],[640,280],[645,250],[650,215],[650,180],
                [645,145],[635,115],[610,90],[570,90],[530,105],[515,150],[515,180],[515,210],[515,240],[525,285],
                [530,315],[540,345],[540,385],[530,425],[515,455],[490,475],[450,475],[425,458],[405,425],[395,390]
            ];
                
                var p4Pos = position;
                var ctx = document.getElementById('myCanvas').getContext('2d');
                var player4 = document.getElementById(avatar);
                // ctx.drawImage(player4, 395, 390, 60, 60);
                ctx.drawImage(player4, player4PosArray[p4Pos][0], player4PosArray[p4Pos][1], 60, 60); 
            };

</script>
    
</head>

<body>
    <audio controls autoplay loop>
    <source src="assets/audio/drums.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
    </audio>
    
    <!-- Div containing canvas and inventory-->
    <div id="canvas-wrap">

        <canvas id="myCanvas" width="800" height="600">
                <menu id="modalBtn">
                </menu>
        </canvas>
                <div class="inventory">
                    <h2 id="pack">Survival Pack</h2>
                        <p id="packMessage" >Should you find yourself in too deep<br>
                        helpful items inside this backpack you should keep</p>
                    <div class="dropdown">
                        <button class="btn btn-default dropdown-toggle" type="button" id="menu1" data-toggle="dropdown">
                            <img id="backpackPic" src="assets/img/backpack.png">
                            <span class="caret"></span>
                        </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="menu1">
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="#"><img id="ropePic" src="assets/img/rope.jpg">Rope</a></li>
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="#"><img id="machetePic" src="assets/img/machete.jpg">Machete</a></li>
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="#"><img id="torchPic" src="assets/img/torch.png">Torch</a></li>
                                <li role="presentation" class="divider"></li>
                            </ul>
                    </div>

                </div>

                <div class="dice-wrap">
                    <img id="dice" src="assets/img/dice.png">
                    <button id="diceBtn">Roll Dice</button>
                    <div id="result"></div
                </div>

    </div>

    <h2 id="status" style="display:none">0 | 0</h2>

    <!-- Image of game board -->
    <img id="gameBoard" width="800" height="600"
    src="assets/img/jumanji_gameboard.svg" style="display: none" alt="Jumanji Game">

    <!-- Avatar images -->
    <img id="skull" src="assets/img/skull.png" style="display: none">
    <img id="sun" src="assets/img/sun.png" style="display: none">
    <img id="magnify" src="assets/img/magnify.png" style="display: none">
    <img id="darth" src="assets/img/darth.png" style="display: none">
    <img id="health" src="assets/img/health.png" style="display: none">
    <img id="home" src="assets/img/home.png" style="display: none">
    <img id="vforven" src="assets/img/vforven.png" style="display: none">
    <img id="sword" src="assets/img/sword.png" style="display: none">

    <!-- Link to index.html -->
    <a href="index.html"><button id="home" class="btn btn-primary btn-lg">Home</button></a>

    <!-- Intro Modal -->
    <!-- Button trigger modal -->
<button id="playBtn" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#modal-1" style="display: none">
        PLAY!
      </button>  
        
      <div class="modal fade" id="modal-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Jumanji Riddle</h4>
            </div>
            <div class="modal-body">
                    <p id="puzzleIntro" style="text-align: left"></p>
              
        <a href="#modal-2" data-toggle="modal" data-dismiss="modal">Click here to accept challenge!</a>
      
              
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->  
        
        
        
        <!-- #modal 2 -->
      <div class="modal fade" id="modal-2">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Jumanji Riddle</h4>
            </div>
            <div class="modal-body">
                    <p id="puzzleDescrip" style="text-align: left"></p>
                    <p style="text-align: left">Choose your survival tactic:</p> 
                    <form id="puzzleChoices" style="text-align: left"></form>
              
        <a href="#modal-3" data-toggle="modal" data-dismiss="modal">< Previous</a>
              
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->

         <script src="assets/js/gameClient.js"></script> 
        <!-- #modal 3 -->
        <div class="modal fade" id="modal-3">
            <div class="modal-dialog">
                <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Jumanji Riddle Results</h4>
                </div>
                <div class="modal-body">
                    <p style="text-align: left">Now you must face the consequences of your choice:</p> 
                    <p id="choiceResult" style="text-align: left"></p>
                    <p id="choiceValue" style="text-align: left"></p>
                    
            <!-- <a href="#modal-1" data-toggle="modal" data-dismiss="modal">< Previous</a> -->
                    
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
            </div><!-- /.modal -->

        <!-- <script src="assets/js/gameClient.js></script> -->

        <script type="text/javascript">

            $( "#diceBtn" ).click(function() {
                console.log("The dice have been rolled");
              });

                var myId = sessionStorage.jumanjiPlayerId;
            
                var string = "/loadturn/";
                string = string + myId
            
                console.log(string);
            
                $.get(string).done(function(gameObj) {
                    console.log(gameObj);

                    draw();

                    drawplayer1(gameObj.myPosition, gameObj.myAvatar);
                    if (gameObj.opponents.length > 0) {
                        drawplayer2(gameObj.opponents[0].position, gameObj.opponents[0].avatar);
                    }
                    if (gameObj.opponents.length > 1) {
                        drawplayer3(gameObj.opponents[1].position, gameObj.opponents[1].avatar);
                        
                    }
                    if (gameObj.opponents.length > 2) {
                        drawplayer4(gameObj.opponents[2].position, gameObj.opponents[2].avatar);
                    }

                    $("#puzzleIntro").text(gameObj.puzzle.intro);

                    $("#puzzleDescrip").text(gameObj.puzzle.description);

                    gameObj.puzzle.choices.forEach(function(choices) {
                    var container = $(`<div class="choice" data-turnId="${gameObj.turnId}" data-choiceId="${choices.choiceId}" ></div>`);
                    container.text(choices.text);
                    $('#puzzleChoices').append(container);
                        var container = $(`<div class="choice" value="${choices.choiceId}" ></div>`);
                        container.text(choices.text);
                        $('#puzzleChoices').append(container);

                    $(".choice").on("click", function() {
                        $("#choiceResult").text(gameObj.puzzle.choices.result);
                        $("#choiceValue").text(gameObj.puzzle.choices.value);

                    });


                    updatePos = function() {
                        
                        randomNum = Math.floor((Math.random()*11)+2);
                        console.log("Number rolled: " + randomNum);
                        $("#result").html(randomNum);
                        var newPos = gameObj.myPosition + randomNum;
                        drawplayer1(newPos, gameObj.myAvatar);
                    };

                    if (gameObj.gameTurn === gameObj.myTurn) {
                        $("#playBtn").fadeIn("slow");
                    };


                        // this function sends data from the roll to a function in gameClient.js
                        endTurn(myId, newPos, gameObj.myTurn)
                    }
                    })

                    })

                    $("#diceBtn").on("click", function() {
                        updatePos();
                    });
            
    </script>

</body>

</html>